title = "NoOps SQLite Database"
template = "cloud_main"
date = "2023-07-26T16:00:00Z"
enable_shortcodes = true
[extra]
url = "https://github.com/fermyon/developer/blob/main/content/cloud/noops-sql-db.md"

---

- [Accessing Private Beta](#accessing-private-beta)
- [Quotas And Service Limitations For the Database in Fermyon Cloud](#quotas-and-service-limitations-for-the-database-in-fermyon-cloud)
- [How To](#how-to)
  - [Database Access From Many Components](#database-access-from-many-components)
  - [Preparing Fermyon Cloud Schema](#preparing-fermyon-cloud-schema)
    - [Source Code](#source-code)
    - [Spin Subcommand](#spin-subcommand)
  - [Deleting the Database](#deleting-the-database)
- [FAQ](#faq)
- [Next Steps](#next-steps)

With NoOps SQL Database using SQLite support in Fermyon Cloud, you can persist relational data generated by your [Spin](../spin/install.md) application in between application invocations without worrying about database management. Fermyon Cloud will provision and manage the database on your behalf; no operations (NoOps) are required. Fermyon Cloud will do the heavy lifting for you. To learn more about the Spin SQLite SDK, please visit the [API guide](../spin/sqlite-api-guide.md).

<iframe width="854" height="480" src="https://www.youtube.com/embed/buwr66oRPbU" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

## Accessing Private Beta

The database in Fermyon Cloud is currently in private beta. To request access to the private beta, please fill out this short [sign-up form](https://fibsu0jcu2g.typeform.com/to/Brv12FI0#hubspot_utk=xxxxx&hubspot_page_name=xxxxx&hubspot_page_url=xxxxx).
 
> Please note that the private beta is limited in space, and all requests cannot be guaranteed. 

Once you have access to the private beta, please ensure you have [Spin CLI](./cli-reference.md) v1.4 or greater, and [`cloud` plugin](https://github.com/fermyon/cloud-plugin) v0.1.2 or greater installed. 

## Quotas And Service Limitations For the Database in Fermyon Cloud

*Quotas* 
* You can have a maximum of 1 NoOps SQL Database in your Cloud account
* Your NoOps SQL Database can hold up 1 GB of data

*Service Limitations*
* The `--sqlite` flag is not supported on `spin cloud deploy`
* Fermyon **Cloud** only supports databases named "default" at this time

## How To

Firstly, if you have not already done so, you will need to [create your first Spin application](https://developer.fermyon.com/spin/quickstart#create-your-first-application). Our blog posts [Announcing Fermyon Cloud’s NoOps SQL Database](https://www.fermyon.com/blog/announcing-noops-sql-db) and [NoOps and Serverless Are the Perfect Pair](https://www.fermyon.com/blog/noops-and-serverless-are-the-perfect-pair) each have an example of how to create a NoOps SQLite Storage application. To tell Spin that we want to use SQLite storage, we only need to [grant SQLite permission to a component in the application’s manifest]((https://developer.fermyon.com/spin/sqlite-api-guide#granting-sqlite-database-permissions-to-components)) (the spin.toml file). For example:

```
[component]
sqlite_databases = ["default"]
```

### Database Access From Many Components

A database is created when you build a Spin application referencing a "default" SQLite database in the component section of an application's manifest. Multiple components in the same Spin application can be given access to the same `default` database like so:

```toml
# c1 does not have access to the default database
[component]
name = "c1"

# c2 can use the default database
[component]
name = "c2"
sqlite_databases = ["default"]

# c3 can use default database as well
[component]
name = "c3"
sqlite_databases = ["default"]
```

The above configuration will last the lifespan of the application.

### Preparing Fermyon Cloud Schema

Once you have a NoOps SQLite Storage Spin application running on localhost, you then prepare the appropriate Fermyon Cloud schema. The reason you need to prepare Fermyon Cloud is that your local Spin application's SQLite database is independent of your Cloud application's database. You can think of your local Spin application as a development and testing environment (with its own test data) and Fermyon Cloud as the production environment (with real user data). There are a couple of different ways in which you can bootstrap your Cloud SQLite database schema (to match your local Spin application):

#### Source Code

The Spin SDK surfaces the Spin SQLite database interface to your language so you can [use SQLite storage from within your application's source code](https://developer.fermyon.com/spin/sqlite-api-guide#using-sqlite-storage-from-applications). Adding SQLite compatible statements via your source code is one way to bootstrap the schema in your Fermyon Cloud application instance. For example you can use a statement like the following to create a table **only** if it does not already exist (note the `IF NOT EXISTS` part of the statement; which would be the case if running your application on Fermyon Cloud for the first time).

```javascript
import {Sqlite} from "@fermyon/spin-sdk"

// -- snip --

export async function handleRequest(request) {
    const conn = Sqlite.openDefault();
    const result = conn.execute("CREATE TABLE IF NOT EXISTS todos (id INTEGER PRIMARY KEY AUTOINCREMENT,description TEXT NOT NULL,due_date DATE,starred BOOLEAN DEFAULT 0,is_completed BOOLEAN DEFAULT 0)");

// -- snip --

}
```
#### Spin Subcommand

The other way to bootstrap your Cloud SQLite database schema is via the `spin cloud sqlite execute` subcommand. Your spin application on localhost will already have randomly assigned a name for your database. You will need this name to run the `spin cloud sqlite execute` subcommand. You can obtain this name by typing the following command in your local application's directory:

<!-- @selectiveCpy -->

```bash
$ spin cloud sqlite list
Databases (1)
inspirational-pig (default)
```

As we can see from the above command, there is one database called `inspirational-pig`. Next, we use that name as part of our `spin cloud sqlite execute` subcommand to create our schema for our Fermyon Cloud application:

```bash
$ spin cloud sqlite execute inspirational-pig "CREATE TABLE IF NOT EXISTS todos (id INTEGER PRIMARY KEY AUTOINCREMENT,description TEXT NOT NULL,due_date DATE,starred BOOLEAN DEFAULT 0,is_completed BOOLEAN DEFAULT 0)"
```

As mentioned above, Fermyon Cloud only supports databases named “default” at this time. Once you add the `sqlite_databases = ["default"]` line to your local Spin application's manifest, Spin internally associates that `default` database with the random name Spin autogenerates, i.e. `inspirational-pig`. The name is not arbitrary and must be used explicitly when using the `spin cloud sqlite execute` subcommand (as shown above). This will allow you to develop your application and continually build locally and deploy to Fermyon Cloud knowing that the two instances (local and Cloud) share the same schema.

### Deleting the Database

Lastly, (warning; using the `delete` subcommand is **permanent**) you can delete your default database with the following command:

```bash
$ spin cloud sqlite delete inspirational-pig
The action is irreversible.
Please type "inspirational-pig" for confirmation: inspirational-pig
Deleting database ...
Database "inspirational-pig" deleted
```

> In the Private Beta, the database is inaccessible once the application has been deleted. However, we separate out the the database deletion step because we anticipate the database being accessible after deletion in a future beta. We enforce database deletion to prevent unintentional data sharing between Spin applications. 

## FAQ

- **Can I export data from my database?**
At this time, Fermyon Cloud does not have a data export feature. We'd love to hear your thoughts on what an ideal experience would look like at [github.com/fermyon/feedback](https://github.com/fermyon/feedback)

- **If I upgrade my Spin application, can I still access the same instance of my database?**
Yes, as long as you haven't deleted your database, the instance will be running and stateful. 

- **If I delete and redeploy my Spin application, can I still access the same instance of my database?**
No, at this time you cannot access the database. You will need to delete the instance and provision a new one. 

## Next Steps

* For support or feature feedback, please join our [Discord channel #no-ops-db-beta](https://discord.gg/XxkZvsya). This is where you can provide feedback and ask for assistance from the Fermyon Cloud team on all things NoOps SQL Database. 
